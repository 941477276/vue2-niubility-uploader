(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["demo-source8"],{b783:function(r,e,n){"use strict";n.r(e),e["default"]='<template>\r\n<div class="demo-edit-image">\r\n    <FileUploader\r\n      ref="uploaderRef"\r\n      :before-remove="onBeroreRemoveFile"\r\n      :request-handler="requestHandler"\r\n      :file-change="onFileChange"\r\n      accept="image/*"\r\n      multiple\r\n      @file-added="onFileAdded"\r\n      @file-upload-error="onFileError">\r\n    </FileUploader>\r\n\r\n    <dialog class="image-edit-dialog" ref="modalDialogRef">\r\n      <div class="dialog-header">\r\n        <h2 style="margin: 0;">模态对话框</h2>\r\n      </div>\r\n      <div class="dialog-content">\r\n        <VueCropper\r\n          class="vue-cropper"\r\n          v-if="showvueCropper"\r\n          ref="cropperRef"\r\n          :src="cropperImgSrc"\r\n          preview=".cropper-preview">\r\n        </VueCropper>\r\n\r\n        <div class="img-operate-area">\r\n          <dl>\r\n            <dt>预览</dt>\r\n            <dd>\r\n              <div class="cropper-preview">\r\n                <img :src="cropperImgSrc" alt="预览">\r\n              </div>\r\n            </dd>\r\n          </dl>\r\n          <button @click.prevent="cropperRotate(-1)">逆时针旋转(-1d)</button>\r\n          <button @click.prevent="cropperRotate(1)">顺时针旋转(+1d)</button>\r\n          <button @click.prevent="cropperFlipX">水平翻转</button>\r\n          <button @click.prevent="cropperFlipY">垂直翻转</button>\r\n          <button @click="cropperReset">重置</button>\r\n        </div>\r\n      </div>\r\n      <div class="dialog-footer">\r\n        <button class="close-btn" :disabled="loading" @click="dialogCancel">取消</button>\r\n        <button :disabled="loading" @click="dialogConfirm">{{ loading ? \'正在操作中...\' : \'确定\' }}</button>\r\n      </div>\r\n    </dialog>\r\n</div>\r\n</template>\r\n\r\n<script >\r\nimport VueCropper from \'vue-cropperjs\';\r\nimport FileUploader from \'@/components/uploader/FileUploader.vue\';\r\n\r\n// 生成文件预览URL\r\nconst generatePreviewUrl = function (file) {\r\n  return new Promise((resolve, reject) => {\r\n    if (!file || !file.type || !file.type.startsWith(\'image/\')) {\r\n      reject(new Error(\'file is not a image!\'));\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      resolve(e.target.result);\r\n    };\r\n    reader.readAsDataURL(file);\r\n  });\r\n}\r\n\r\nexport default {\r\n  name: "DemoEditImage",\r\n  components: {\r\n    FileUploader,\r\n    VueCropper\r\n  },\r\n  data () {\r\n    return {\r\n      showvueCropper: false,\r\n      loading: true,\r\n      cropperImgSrc: \'\',\r\n      cropperPreview: \'\',\r\n      cropperRotateDeg: 0,\r\n      flipXDir: 1,\r\n      flipYDir: 1,\r\n\r\n      dialogFile: null,\r\n      dialogImgPreviewUrl: \'\'\r\n    };\r\n  },\r\n  methods: {\r\n    onFileChange (file) {\r\n      console.log(\'onFileChange\', file);\r\n      this.$nextTick(() => {\r\n        // 显示图片编辑弹窗\r\n        this.showImageEditorDialog(file);\r\n      });\r\n      // 选择文件时不自定加入文件列表，后面手动加入\r\n      return false;\r\n    },\r\n    onFileAdded (file) {\r\n      console.log(\'文件添加:\', file);\r\n    },\r\n    onFileError (error) {\r\n      console.error(\'上传错误:\', error);\r\n    },\r\n    /**\r\n     * 文件校验出错\r\n     * @param errorInfo\r\n     */\r\n    onFileExceed (errorInfo) {\r\n      console.log(\'文件校验出错\', errorInfo);\r\n      alert(errorInfo.message);\r\n    },\r\n    /**\r\n     * 请求处理器\r\n     * @param fileData\r\n     */\r\n    requestHandler (fileData) {\r\n      console.log(\'requestHandler\', fileData);\r\n      let {\r\n        file,\r\n        isUploadChunk,\r\n        name\r\n      } = fileData;\r\n\r\n      if (!isUploadChunk) { // 上传单个文件\r\n        return {\r\n          url: \'http://localhost:3001/upload\',\r\n          method: \'POST\',\r\n          data: {\r\n            file: file,\r\n            name\r\n          }\r\n        };\r\n      }\r\n    },\r\n    /**\r\n     *  请求响应处理器\r\n     * @param fileData\r\n     * @returns {Promise<never>}\r\n     */\r\n    respondHandler (fileData) {\r\n      console.log(\'respondHandler\', fileData);\r\n      // return Promise.reject(\'abc\');\r\n    },\r\n    onBeroreRemoveFile (fileData) {\r\n      return new Promise(function (resolve, reject) {\r\n        var res = window.confirm(`确定要移除“${fileData.name}”文件吗？`);\r\n        return res ? resolve() : reject(res);\r\n      });\r\n    },\r\n    // 显示图片编辑弹窗\r\n    showImageEditorDialog (file) {\r\n      this.dialogFile = file;\r\n      this.loading = true;\r\n      generatePreviewUrl(file)\r\n        .then(res => {\r\n          this.dialogImgPreviewUrl = res;\r\n          this.cropperImgSrc = res;\r\n          this.$refs.modalDialogRef.showModal();\r\n          this.$nextTick(() => {\r\n            this.showvueCropper = true;\r\n            this.loading = false;\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          this.loading = false;\r\n          alert(error.message);\r\n        });\r\n    },\r\n    dialogCancel () {\r\n      console.log(\'弹窗关闭了\');\r\n      this.loading = true;\r\n      this.addFileToUploader(this.dialogFile);\r\n      this.$refs.modalDialogRef.close();\r\n      this.dialogFile = null;\r\n      this.dialogImgPreviewUrl = \'\';\r\n      this.cropperImgSrc = \'\';\r\n      this.showvueCropper = false;\r\n      this.loading = false;\r\n    },\r\n    dialogConfirm () {\r\n      this.loading = true;\r\n      this.addFileToUploader(this.cropperGetImageData());\r\n      this.$refs.modalDialogRef.close();\r\n      this.dialogFile = null;\r\n      this.dialogImgPreviewUrl = \'\';\r\n      this.cropperImgSrc = \'\';\r\n      this.showvueCropper = false;\r\n      this.loading = false;\r\n    },\r\n    // 将文件添加到上传器\r\n    addFileToUploader (fileData) {\r\n      let dialogFile = this.dialogFile;\r\n      this.$refs.uploaderRef.addFile({\r\n        name: dialogFile.name,\r\n        type: dialogFile.type,\r\n        file: fileData,\r\n        previewUrl: typeof fileData == \'string\' ? fileData : \'\',\r\n        extendData: {\r\n          originalImageData: this.dialogImgPreviewUrl\r\n        }\r\n      });\r\n    },\r\n    cropperGetImageData () {\r\n      let base64Img = this.$refs.cropperRef.getCroppedCanvas().toDataURL();\r\n      console.log(\'cropperGetImageData\', base64Img);\r\n      return base64Img;\r\n    },\r\n    cropperReset() {\r\n      this.$refs.cropperRef.reset();\r\n    },\r\n    cropperRotate(degIncrements) {\r\n      let deg = this.cropperRotateDeg + (degIncrements || 1);\r\n      if (deg > 360) {\r\n        deg = 360;\r\n      } else if (deg < -360) {\r\n        deg = -360;\r\n      }\r\n      this.cropperRotateDeg = deg;\r\n      this.$refs.cropperRef.rotate(deg);\r\n    },\r\n    cropperFlipX() {\r\n      let scale = this.flipXDir;\r\n      scale = scale ? -scale : -1;\r\n      this.$refs.cropperRef.scaleX(scale);\r\n      this.flipXDir = scale;\r\n    },\r\n    cropperFlipY() {\r\n      let scale = this.flipYDir;\r\n      scale = scale ? -scale : -1;\r\n      this.$refs.cropperRef.scaleY(scale);\r\n      this.flipYDir = scale;\r\n    },\r\n    // showDialog\r\n  }\r\n}\r\n<\/script>\r\n\r\n<style lang="scss" scoped>\r\n.image-edit-dialog {\r\n  border: none;\r\n  border-radius: 12px;\r\n  padding: 0;\r\n  box-shadow: 0 20px 60px rgba(0,0,0,0.3);\r\n  width: 90%;\r\n  max-width: 768px;\r\n}\r\n\r\n.image-edit-dialog::backdrop {\r\n  background: rgba(0,0,0,0.5);\r\n  backdrop-filter: blur(3px);\r\n}\r\n\r\n.dialog-header {\r\n  background: linear-gradient(45deg, #667eea, #764ba2);\r\n  color: white;\r\n  padding: 15px 30px;\r\n  border-radius: 12px 12px 0 0;\r\n}\r\n\r\n.dialog-header h2 {\r\n  font-size: 18px;\r\n}\r\n\r\n.dialog-content {\r\n  //display: flex;\r\n  padding: 20px 30px;\r\n}\r\ndialog button {\r\n  background: linear-gradient(45deg, #667eea, #764ba2);\r\n  color: white;\r\n  border: none;\r\n  outline: none;\r\n  padding: 10px 20px;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  font-size: 14px;\r\n  transition: all 0.3s ease;\r\n}\r\n.vue-cropper{\r\n  flex: 1;\r\n  height: 420px;\r\n}\r\n.img-operate-area{\r\n  padding-top: 15px;\r\n  dl{\r\n    display: inline-block;\r\n    margin: 0;\r\n  }\r\n  dt{\r\n    font-weight: bold;\r\n  }\r\n  dd{\r\n    margin: 5px 0 15px 25px;\r\n  }\r\n  button{\r\n    display: inline-block;\r\n    vertical-align: bottom;\r\n    margin-left: 15px;\r\n    margin-bottom: 15px;\r\n  }\r\n}\r\n.cropper-preview{\r\n  width: 120px;\r\n  height: 200px;\r\n  overflow: hidden;\r\n}\r\n\r\n.dialog-footer {\r\n  padding: 20px;\r\n  border-top: 1px solid #eee;\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 10px;\r\n}\r\n\r\n.close-btn {\r\n  background: #6c757d;\r\n}\r\n\r\n.close-btn:hover {\r\n  background: #5a6268;\r\n}\r\n</style>\r\n'}}]);
//# sourceMappingURL=demo-source8.ec5ff0cd.js.map