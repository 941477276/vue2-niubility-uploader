{"version":3,"sources":["webpack:///./src/views/usage-demos/BreakpointResume.vue?ce65"],"names":[],"mappings":"8GAAA,OAAe","file":"js/demo-source4.b281fd47.js","sourcesContent":["export default \"<template>\\r\\n  <div>\\r\\n    <FileUploader\\r\\n      :before-upload=\\\"onBeforeUpload2\\\"\\r\\n      :request-handler=\\\"requestHandler\\\"\\r\\n      :chunk-upload-completed=\\\"onChunkUploadCompleted\\\"\\r\\n      :chunk-size=\\\"1024 * 100\\\"\\r\\n      :batch-chunk-concurrent-uploads=\\\"3\\\"\\r\\n      :chunk-size-threshold=\\\"1024*1024\\\"\\r\\n      :before-upload-chunk=\\\"onBeforeUploadChunk\\\"\\r\\n      use-chunked-upload\\r\\n      multiple>\\r\\n    </FileUploader>\\r\\n  </div>\\r\\n</template>\\r\\n\\r\\n<script>\\r\\nimport FileUploader from '@/components/uploader/FileUploader.vue'\\r\\n\\r\\nexport default {\\r\\n  name: \\\"BreakpointResume\\\",\\r\\n  components: { FileUploader },\\r\\n  data () {\\r\\n    return {\\r\\n      uploadedChunkIndexes: '0,3,4,7,10,11,12,15'\\r\\n    };\\r\\n  },\\r\\n  methods: {\\r\\n    /**\\r\\n     * 请求处理器\\r\\n     * @param fileData\\r\\n     */\\r\\n    requestHandler (fileData) {\\r\\n      console.log('requestHandler', fileData);\\r\\n      let {\\r\\n        file,\\r\\n        isUploadChunk,\\r\\n        chunk,\\r\\n        // id,\\r\\n        chunkIndex,\\r\\n        name,\\r\\n        fileData: chunkFileData\\r\\n      } = fileData;\\r\\n\\r\\n      if (!isUploadChunk) { // 上传单个文件\\r\\n        return {\\r\\n          url: 'http://localhost:3001/upload',\\r\\n          method: 'POST',\\r\\n          data: {\\r\\n            file: file,\\r\\n            name\\r\\n          }\\r\\n        };\\r\\n      }\\r\\n      let formData = new FormData();\\r\\n      formData.append('file', chunk);\\r\\n      formData.append('fileName', chunkFileData.file.name);\\r\\n      formData.append('uploadId', chunkFileData.id);\\r\\n      formData.append('chunkIndex', chunkIndex);\\r\\n      formData.append('totalChunks', chunkFileData.chunks);\\r\\n      formData.append('chunkMd5', fileData.extraData.chunkMd5);\\r\\n      return { // 上传分片文件\\r\\n        url: 'http://localhost:3001/upload/chunk',\\r\\n        method: 'POST',\\r\\n        data: formData\\r\\n      }\\r\\n    },\\r\\n    onFileComplete (fileData) {\\r\\n      console.log('文件上传完成:', fileData);\\r\\n      return new Promise((resolve, reject) => {\\r\\n        if (fileData.useChunked) {\\r\\n          // 分片上传完成后的处理\\r\\n          const xhr = new XMLHttpRequest();\\r\\n          const data = {\\r\\n            uploadId: fileData.id,\\r\\n            fileName: fileData.file.name,\\r\\n            fileSize: fileData.file.size,\\r\\n          };\\r\\n\\r\\n          xhr.addEventListener('load', () => {\\r\\n            if (xhr.status === 200) {\\r\\n              resolve();\\r\\n            } else {\\r\\n              reject(new Error(xhr.statusText));\\r\\n            }\\r\\n          });\\r\\n\\r\\n          xhr.addEventListener('error', () => {\\r\\n            reject({\\r\\n              xhr,\\r\\n              code: xhr.status,\\r\\n              message: 'Network error'\\r\\n            });\\r\\n          });\\r\\n\\r\\n          xhr.open('POST', 'http://localhost:3001/upload/finalize');\\r\\n          xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');\\r\\n          xhr.send(JSON.stringify(data));\\r\\n        } else {\\r\\n          resolve();\\r\\n        }\\r\\n      });\\r\\n    },\\r\\n    /**\\r\\n     *  请求响应处理器\\r\\n     * @param fileData\\r\\n     * @returns {Promise<never>}\\r\\n     */\\r\\n    respondHandler (fileData) {\\r\\n      console.log('respondHandler', fileData);\\r\\n    },\\r\\n    onBeforeUpload2 (fileData) {\\r\\n      if (!fileData.useChunked) {\\r\\n        return Promise.resolve();\\r\\n      }\\r\\n\\r\\n      return new Promise((resolve, reject) => {\\r\\n        let uploadedChunkIndexes = [];\\r\\n        let uploadedChunkIndexesStr = this.uploadedChunkIndexes;\\r\\n        if (uploadedChunkIndexesStr) {\\r\\n          uploadedChunkIndexes = uploadedChunkIndexesStr.split(',').map(item => {\\r\\n            return parseInt(item);\\r\\n          }).filter(item => !isNaN(item));\\r\\n        }\\r\\n\\r\\n        const xhr = new XMLHttpRequest();\\r\\n        const data = {\\r\\n          uploadId: fileData.id,\\r\\n          fileName: fileData.file.name,\\r\\n          fileSize: fileData.file.size,\\r\\n          fileType: fileData.file.type,\\r\\n        };\\r\\n\\r\\n        xhr.open('POST', 'http://localhost:3001/upload/init');\\r\\n        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');\\r\\n        xhr.addEventListener('load', () => {\\r\\n          if (xhr.status >= 200 && xhr.status < 300) {\\r\\n            try {\\r\\n              // 设置已上传的分片索引，组件在上传分片时会跳过这些已上传的分片\\r\\n              fileData.setUploadedChunks(fileData.id, uploadedChunkIndexes);\\r\\n              const response = JSON.parse(xhr.responseText);\\r\\n              resolve(response);\\r\\n            } catch (e) {\\r\\n              reject(new Error('Invalid response from server'));\\r\\n            }\\r\\n          } else {\\r\\n            reject(new Error(`HTTP ${xhr.status}: ${xhr.statusText}`));\\r\\n          }\\r\\n        });\\r\\n        xhr.addEventListener('error', () => {\\r\\n          reject(new Error('Network error occurred during upload initialization'));\\r\\n        });\\r\\n        xhr.send(JSON.stringify(data));\\r\\n      });\\r\\n    },\\r\\n    onBeforeUploadChunk (chunkData) {\\r\\n      console.log('chunkData', chunkData);\\r\\n      return new Promise((resolve) => {\\r\\n        setTimeout(function () {\\r\\n          resolve({\\r\\n            chunkMd5: 'chunk_' + new Date().getTime()\\r\\n          })\\r\\n        }, 1000)\\r\\n      })\\r\\n    },\\r\\n    // 分片全部上传完成事件\\r\\n    onChunkUploadCompleted (fileData) {\\r\\n      console.log('分片全部上传完成', fileData.name);\\r\\n      return this.onFileComplete(fileData);\\r\\n    },\\r\\n  }\\r\\n}\\r\\n</script>\\r\\n\";"],"sourceRoot":""}